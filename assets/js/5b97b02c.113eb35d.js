"use strict";(self.webpackChunknanocosomos_documentation=self.webpackChunknanocosomos_documentation||[]).push([[1121],{1272:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"nanoplayer/nanoplayer_feature_security_sts","title":"Secure playback with STS tokens","description":"Signing URLs","source":"@site/docs/nanoplayer/nanoplayer_feature_security_sts.md","sourceDirName":"nanoplayer","slug":"/nanoplayer/nanoplayer_feature_security_sts","permalink":"/docs/nanoplayer/nanoplayer_feature_security_sts","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1751618628000,"frontMatter":{"id":"nanoplayer_feature_security_sts","title":"Secure playback with STS tokens"}}');var a=t(74848),r=t(28453);const s={id:"nanoplayer_feature_security_sts",title:"Secure playback with STS tokens"},o=void 0,c={},l=[{value:"Signing URLs",id:"signing-urls",level:2},{value:"Available Parameters",id:"available-parameters",level:3},{value:"Generate a token ...",id:"generate-a-token-",level:3},{value:"(a) ...with a Bintu stream name, custom tag, and an expiration date in the future",id:"a-with-a-bintu-stream-name-custom-tag-and-an-expiration-date-in-the-future",level:3},{value:"(b) ...with a Bintu orga hash, custom tag, and an expiration date in the future",id:"b-with-a-bintu-orga-hash-custom-tag-and-an-expiration-date-in-the-future",level:3},{value:"(c) ...with a client IP",id:"c-with-a-client-ip",level:3},{value:"(d) ...with a custom tag and a referer",id:"d-with-a-custom-tag-and-a-referer",level:3},{value:"Verifying playbacks",id:"verifying-playbacks",level:2},{value:"Integrating secure H5Live player configuration with STS token",id:"integrating-secure-h5live-player-configuration-with-sts-token",level:2},{value:"Update secure tokens during playback",id:"update-secure-tokens-during-playback",level:2},{value:"Using secure tokens for ABR",id:"using-secure-tokens-for-abr",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"signing-urls",children:"Signing URLs"}),"\n",(0,a.jsx)(n.h3,{id:"available-parameters",children:"Available Parameters"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"expires"}),": Expiration date in seconds as ",(0,a.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Unix_time",children:"Unix time format"}),". The token will be only valid until the given expiration date. A token is only validated when a stream playback is started or a reconnect happens. So if there is no reconnect, the stream playback continues even if the token expires during the playback."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"referer"}),": A domain name. Can be used to restrict a token to a specific domain, e.g. ",(0,a.jsx)(n.code,{children:"demo.nanocosmos.de"}),". Notice that wildcards (",(0,a.jsx)(n.code,{children:"*"}),") are currently not supported."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"tag"}),": A tag is just a custom string which will be included into a token. It is a customer's responsibility to manage the tags included into the tokens. We do not store them anywhere on our side.","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Sample use case: track which tokens were generated for a customer ID"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"Bintu stream name"}),": The stream name, which is managed by ",(0,a.jsx)(n.a,{href:"../cloud/bintu_api",children:"Bintu"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"Bintu orga hash"}),": The hash of your ",(0,a.jsx)(n.a,{href:"../cloud/bintu_api",children:"Bintu"})," organization. It is possible to generate a token which is valid for all streams of an organization."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"ip"}),": An IPv4 address to restrict token usage to a specific client IP, e.g., ",(0,a.jsx)(n.code,{children:"101.0.123.45"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"generate-a-token-",children:"Generate a token ..."}),"\n",(0,a.jsx)(n.admonition,{title:"Attention",type:"caution",children:(0,a.jsxs)(n.p,{children:["The expiration date time for the parameter ",(0,a.jsx)(n.code,{children:"expires"})," is expected to be in ",(0,a.jsx)(n.strong,{children:"SECONDS"}),". Using milliseconds will lead to expiration dates far in the future and won't be accepted by the token generation API!"]})}),"\n",(0,a.jsx)(n.h3,{id:"a-with-a-bintu-stream-name-custom-tag-and-an-expiration-date-in-the-future",children:"(a) ...with a Bintu stream name, custom tag, and an expiration date in the future"}),"\n",(0,a.jsx)(n.p,{children:"Test data (additional):"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Expires: 1591747200 = 06/10/2020 @ 12:00am (UTC) ",(0,a.jsx)(n.strong,{children:"[expiration date and time in SECONDS in Unix time format and UTC; cannot be in the past or more than 365 days in the future]"})]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.em,{children:"Request:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'curl -X POST https://bintu-splay.nanocosmos.de/secure/token -H "Content-Type: application/json" -H "X-BINTU-APIKEY: [your Bintu API key]" -d "{\\"streamname\\": \\"[your Bintu stream name]\\", \\"tag\\": \\"[your custom tag]\\", \\"expires\\": \\"1591747200\\"}"\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.em,{children:"Response:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:'{\n    "h5live": {\n        "security": {\n            "expires": "1591747200",\n            "tag": "[your custom tag]",\n            "token": "[your token will be here]",\n            "options": "9"\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"b-with-a-bintu-orga-hash-custom-tag-and-an-expiration-date-in-the-future",children:"(b) ...with a Bintu orga hash, custom tag, and an expiration date in the future"}),"\n",(0,a.jsx)(n.p,{children:"Test data (additional):"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Expires: 1591747200 = 06/10/2020 @ 12:00am (UTC) ",(0,a.jsx)(n.strong,{children:"[expiration date and time in SECONDS in Unix time format and UTC; cannot be in the past or more than 365 days in the future]"})]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.em,{children:"Request:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'curl -X POST https://bintu-splay.nanocosmos.de/secure/token -H "Content-Type: application/json" -H "X-BINTU-APIKEY: [your Bintu API key]" -d "{\\"orga\\": \\"[your Bintu orga hash]\\", \\"tag\\": \\"[your custom tag]\\", \\"expires\\": \\"1591747200\\"}"\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.em,{children:"Response:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:'{\n    "h5live": {\n        "security": {\n            "expires": "1591747200",\n            "tag": "[your custom tag]",\n            "token": "[your token will be here]",\n            "options": "25"\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"c-with-a-client-ip",children:"(c) ...with a client IP"}),"\n",(0,a.jsx)(n.p,{children:"Adding IP restrictions to STS tokens:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["ip ",(0,a.jsx)(n.strong,{children:"[The ip parameter restricts the usage of the token to a specific IPv4 address. This is useful when you want to limit access to a token from a known client IP only.]"})]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.em,{children:"Request:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'curl -X POST https://bintu-splay.nanocosmos.de/secure/token -H "Content-Type: application/json" -H "X-BINTU-APIKEY: [your Bintu API key]" -d "{\\"streamname\\": \\"[your Bintu stream name]\\", \\"ip\\": \\"[your client ip]\\"}"\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.em,{children:"Response:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:'{\n    "h5live": {\n        "security": {\n            "expires": "",\n            "tag": "",\n            "token": "[your token will be here]",\n            "options": "2"\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"d-with-a-custom-tag-and-a-referer",children:"(d) ...with a custom tag and a referer"}),"\n",(0,a.jsx)(n.p,{children:"Test data (additional):"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Referer: ",(0,a.jsx)(n.code,{children:"demo.nanocosmos.de [a valid referer is a domain name which meets the requirement below]"})]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Referer requirements:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The full domain name may not exceed the length of 253 characters (including delimiting dots, but not a trailing dot) in its textual representation."}),"\n",(0,a.jsx)(n.li,{children:"The domain name part may contain from 1 to 63 characters."}),"\n",(0,a.jsx)(n.li,{children:"The domain name may contain: a-z | A-Z | 0-9, periods (.), and hyphens (-)."}),"\n",(0,a.jsx)(n.li,{children:"The domain name may have a trailing period (.), the root domain."}),"\n",(0,a.jsx)(n.li,{children:"The domain name should not start or end with a hyphen (-)."}),"\n",(0,a.jsx)(n.li,{children:"The top-level domain (TLD) should not include digits only."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Valid referers (examples):"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"nanocosmos.de"}),"\n",(0,a.jsx)(n.li,{children:"demo.nanocosmos.de"}),"\n",(0,a.jsx)(n.li,{children:"demo-nanocosmos123.de"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Invalid referers (examples):"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"https://demo.nanocosmos.de",children:"https://demo.nanocosmos.de"})," - Cannot include a protocol"]}),"\n",(0,a.jsx)(n.li,{children:"nanocosmos.de/nanoplayer - Cannot include a resource ID (\u201c/nanoplayer\u201d)"}),"\n",(0,a.jsx)(n.li,{children:"nanocosmos - Must include a TLD"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.em,{children:"Request"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'curl -X POST https://bintu-splay.nanocosmos.de/secure/token -H "Content-Type: application/json" -H "X-BINTU-APIKEY: [your Bintu API key]" -d "{\\"streamname\\": \\"[your Bintu stream name]\\", \\"tag\\": \\"[your custom tag]\\", \\"referer\\": \\"demo.nanocosmos.de\\"}"\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.em,{children:"Response"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n    "h5live": {\n        "security": {\n            "expires": "",\n            "tag": "[your custom tag]",\n            "token": "[your token will be here]",\n            "options": "12"\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"verifying-playbacks",children:"Verifying playbacks"}),"\n",(0,a.jsxs)(n.p,{children:["To test that a token works as expected you can either configure the token parameters in the ",(0,a.jsx)(n.a,{href:"/docs/nanoplayer/nanoplayer_feature_stream_switching#single-stream-configuration",children:"player configuration"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:'"security": {\n    "expires": "[your expire date]",\n    "tag": "[your custom tag]",\n    "token": "[your token]",\n    "options": "[your option]"\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"or use URL parameters - you have to replace the highlighted parameter values with your specific values:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"https://demo.nanocosmos.de/nanoplayer/release/nanoplayer.html?h5live.server.websocket=wss://bintu-splay.nanocosmos.de/h5live/authstream&h5live.server.hls=https://bintu-splay.nanocosmos.de/h5live/authhttp/playlist.m3u8&h5live.rtmp.url=rtmp://bintu-splay.nanocosmos.de/splay&h5live.rtmp.streamname=<b>[your Bintu stream name]</b>&h5live.security.expires=<b>[expires from response]</b>&h5live.security.tag=<b>[tag from response]</b>&h5live.security.token=<b>[token from response]</b>&h5live.security.options=<b>[options from response]</b>"})}),"\n",(0,a.jsx)(n.admonition,{title:"Explanation",type:"info",children:(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Step 2 (a): the URL hasn\u2019t expired yet, so the playback works for a particular stream."}),"\n",(0,a.jsx)(n.li,{children:"Step 2 (b): the URL hasn\u2019t expired yet, so the playback works for all the stream for a particular Bintu orga hash."}),"\n",(0,a.jsx)(n.li,{children:"Step 2 (c): the playback only works for a specified client ip."}),"\n",(0,a.jsx)(n.li,{children:"Step 2 (d): the referrer is demo.nanocosmos.de, so the playback works."}),"\n"]})}),"\n",(0,a.jsxs)(n.p,{children:["To verify that the playback doesn't work with an incorrect referrer,\ncopy the H5Live player code snippet to an ",(0,a.jsx)(n.code,{children:".html"})," file on a different domain.\nTry to playback the stream from the newly created web page."]}),"\n",(0,a.jsx)(n.admonition,{title:"Explanation",type:"caution",children:(0,a.jsxs)(n.p,{children:["The referrer is not ",(0,a.jsx)(n.code,{children:"demo.nanocosmos.de"}),", so the playback doesn\u2019t work."]})}),"\n",(0,a.jsx)(n.h2,{id:"integrating-secure-h5live-player-configuration-with-sts-token",children:"Integrating secure H5Live player configuration with STS token"}),"\n",(0,a.jsx)(n.p,{children:"Here are example code snippets to test the H5Live player with secure tokens."}),"\n",(0,a.jsxs)(n.admonition,{type:"info",children:[(0,a.jsx)(n.mdxAdmonitionTitle,{}),(0,a.jsxs)(n.p,{children:["Refer to the detailed example code in ",(0,a.jsx)(n.a,{href:"/docs/nanoplayer/nanoplayer_getting_started",children:"Embedding H5Live player on your own web page"})," and modify the relevant sections to include playback security."]})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-html",children:'<div id="playerDiv"></div>\n<script src="https://demo.nanocosmos.de/nanoplayer/api/release/nanoplayer.4.min.js?20200806"><\/script>\n<script>\nvar player;\nvar streamName = "XXXXX-YYYYY"; // your stream name (NOT the bintu stream ID)\nvar config = {\n    "source": {\n        "entries": [\n            {\n                "h5live": {\n                    "rtmp": {\n                        "url": "rtmp://bintu-splay.nanocosmos.de/splay",\n                        "streamname": streamName\n                    },\n                    "server": {\n                        "websocket": "wss://bintu-h5live-secure.nanocosmos.de/h5live/authstream",\n                        "hls": "https://bintu-h5live-secure.nanocosmos.de/h5live/authhttp/playlist.m3u8"\n                    },\n                    "security": {\n                        "expires": "[your expiry date]",\n                        "tag": "[your custom tag]",\n                        "token": "[your token]",\n                        "options": "[your option]"             \n                    }                    \n                }                \n            }\n        ]\n    },\n    "playback": {\n        "autoplay": true,\n        "automute": true,\n        "muted": true\n    },\n    "style": {\n        "displayMutedAutoplay": true\n    }\n};\ndocument.addEventListener(\'DOMContentLoaded\', function () {\n    player = new NanoPlayer("playerDiv");\n    player.setup(config).then(function (config) {\n        console.log("setup success");\n        console.log("config: " + JSON.stringify(config, undefined, 4));\n    }, function (error) {\n        alert(error.message);\n    });\n});\n<\/script>\n'})}),"\n",(0,a.jsx)(n.h2,{id:"update-secure-tokens-during-playback",children:"Update secure tokens during playback"}),"\n",(0,a.jsxs)(n.p,{children:["It is also possible to update an expiring secure token for a client, with a new token, during the playback of the stream via the ",(0,a.jsx)(n.a,{href:"nanoplayer_update_source",children:"updateSource"})," method.\nThe ",(0,a.jsx)(n.code,{children:"updateSource"})," method always expects a new source object as a parameter. As you may notice this object is similar to the structure of the config object you are using to set up the player."]}),"\n",(0,a.jsx)(n.p,{children:"If you are using the:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"nanoplayer_feature_stream_switching/#example-new-single-stream-configuration",children:"new single / multi stream configuration notation"}),":\nonly change the ",(0,a.jsx)(n.code,{children:"security"})," object inside the desired ",(0,a.jsx)(n.code,{children:"entry"})," object (e.g. for the first entry: ",(0,a.jsx)(n.code,{children:"config.source.entries[0].h5live.security = { YOUR CHANGED SECURITY DETAILS FOR FIRST ENTRY }"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"nanoplayer_feature_stream_switching/#example-old-single-stream-configuration-deprecated",children:"old single configuration notation"}),": only change the ",(0,a.jsx)(n.code,{children:"security"})," object inside the ",(0,a.jsx)(n.code,{children:"h5live"})," object (",(0,a.jsx)(n.code,{children:"config.source.h5live.security = { YOUR CHANGED SECURITY DETAILS }"}),")"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["You can leave the rest of the stream information unchanged. After updating the local config object you need to call the ",(0,a.jsx)(n.code,{children:"updateSource"})," method with the new source (",(0,a.jsx)(n.code,{children:"config.source"}),") as a parameter to replace the existing source inside the player."]}),"\n",(0,a.jsxs)(n.p,{children:["More detailed information can be found in the ",(0,a.jsx)(n.a,{href:"nanoplayer_api#nanoplayerupdatesourcesource-%E2%87%92-codepromiseltconfigerrorgtcode",children:"nanoPlayer API"})," or in the ",(0,a.jsx)(n.a,{href:"nanoplayer_api#NanoPlayer+updateSource",children:"updateSource feature description"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"using-secure-tokens-for-abr",children:"Using secure tokens for ABR"}),"\n",(0,a.jsxs)(n.p,{children:["If secure playback should be used for an ABR multi-stream configuration, a secure token has to be generated for ",(0,a.jsx)(n.strong,{children:"each stream independently"}),". That means that the ",(0,a.jsx)(n.code,{children:"security"})," object has to be set for each entry (e.g. for the first entry: ",(0,a.jsx)(n.code,{children:"config.source.entries[0].h5live.security = { SECURITY DETAILS FOR FIRST ENTRY }"}),"). The configuration of multiple streams/entries with ABR and secure tokens is described ",(0,a.jsx)(n.a,{href:"nanoplayer_feature_stream_switching#example-multi-stream-configuration-with-abr-and-playback-security",children:"here"}),"."]}),"\n",(0,a.jsx)(n.admonition,{title:"Important",type:"caution",children:(0,a.jsxs)(n.p,{children:["E.g. for ",(0,a.jsx)(n.strong,{children:"three streams"})," the security object has to be configured ",(0,a.jsx)(n.strong,{children:"three times"})," with a ",(0,a.jsx)(n.strong,{children:"separate token for each stream"}),"."]})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var i=t(96540);const a={},r=i.createContext(a);function s(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);