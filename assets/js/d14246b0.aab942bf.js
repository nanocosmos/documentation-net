"use strict";(self.webpackChunknanocosomos_documentation=self.webpackChunknanocosomos_documentation||[]).push([[6344],{28453:(e,n,a)=>{a.d(n,{R:()=>o,x:()=>r});var t=a(96540);const s={},i=t.createContext(s);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:n},e.children)}},51494:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"nanoplayer/nanoplayer_feature_video_access_and_processing","title":"Video Access and Processing","description":"Video access and processing using onActiveVideoElementChange","source":"@site/docs/nanoplayer/nanoplayer_feature_video_access_and_processing.md","sourceDirName":"nanoplayer","slug":"/nanoplayer/nanoplayer_feature_video_access_and_processing","permalink":"/docs/nanoplayer/nanoplayer_feature_video_access_and_processing","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1751618628000,"frontMatter":{"id":"nanoplayer_feature_video_access_and_processing","title":"Video Access and Processing","sidebar_label":"Video Access and Processing"},"sidebar":"H5Live Player","previous":{"title":"Source defaults","permalink":"/docs/nanoplayer/nanoplayer_feature_source_defaults"},"next":{"title":"Latest","permalink":"/docs/nanoplayer/nanoplayer_release_latest"}}');var s=a(74848),i=a(28453);const o={id:"nanoplayer_feature_video_access_and_processing",title:"Video Access and Processing",sidebar_label:"Video Access and Processing"},r=void 0,c={},l=[{value:"Video access and processing using <code>onActiveVideoElementChange</code>",id:"video-access-and-processing-using-onactivevideoelementchange",level:2},{value:"How to use <code>onActiveVideoElementChange</code> to take a snapshot",id:"how-to-use-onactivevideoelementchange-to-take-a-snapshot",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h2,{id:"video-access-and-processing-using-onactivevideoelementchange",children:["Video access and processing using ",(0,s.jsx)(n.code,{children:"onActiveVideoElementChange"})]}),"\n",(0,s.jsxs)(n.p,{children:["Introduced in ",(0,s.jsx)(n.strong,{children:"nanoStream H5Live Player Version 4.17.0"}),", the new ",(0,s.jsx)(n.code,{children:"onActiveVideoElementChange"})," event is providing access to the active video element. This is enabling video processing use cases such as canvas drawing, snapshoting and in similar occasions when the currently active video element is necessary. The event will be executed when the video element has been activated or changed. Find out more in our API events' section: ",(0,s.jsx)(n.a,{href:"./nanoplayer_api#onactivevideoelementchange",children:(0,s.jsx)(n.code,{children:"onActiveVideoElementChange"})}),"."]}),"\n",(0,s.jsx)(n.admonition,{title:"Important",type:"info",children:(0,s.jsx)(n.p,{children:"Video elements should be treated as read-only and not be altered via properties or method calls."})}),"\n",(0,s.jsx)(n.p,{children:"For functional reasons, on iOS there are 2 video elements. As the event will be fired always on switch/creation etc, there would be an indication which video element is currently displayed."}),"\n",(0,s.jsxs)(n.p,{children:["In case of iOS stream switching, please read more about the ",(0,s.jsx)(n.a,{href:"./nanoplayer_feature_stream_switching/",children:"stream switch feature"}),"."]}),"\n",(0,s.jsx)(n.admonition,{title:"Canvas drawing might not be supported in all browsers",type:"caution",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Canvas drawing with Media Source Extensions is not supported in Safari macOS and iPadOS desktop mode (by August 2022)"}),"\n",(0,s.jsxs)(n.li,{children:["Experimental support behind the feature flag ",(0,s.jsx)(n.code,{children:"Experimental MediaSource Inline Painting"})," has been added in Safari 15.4"]}),"\n"]})}),"\n",(0,s.jsxs)(n.h2,{id:"how-to-use-onactivevideoelementchange-to-take-a-snapshot",children:["How to use ",(0,s.jsx)(n.code,{children:"onActiveVideoElementChange"})," to take a snapshot"]}),"\n",(0,s.jsx)(n.p,{children:"To draw/render image on the canvas or save a snapshot from the video, it is necessary to properly setup the player configuration, declare necessary variables and add functions which will get and then display the image."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"In the html page, add the player and shapshot holder and load the player script."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",metastring:"showLineNumbers",children:'<div>\n    <label>Playback</label>\n    \x3c!-- the container element for the player --\x3e\n    <div id="playerDiv" style="width: 100%;padding-top: 56.25%;"></div>\n    <label>Snapshot</label>\n    \x3c!-- the image element for the snapshot --\x3e\n    <img id="image"/>\n</div>\n<script type="text/javascript" src="nanoplayer.4.min.js"><\/script>\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["Setup the player configuration and declare necessary variables to enable the active video element feature. Due to cross-origin policies for video elements, it is required to set ",(0,s.jsx)(n.code,{children:"'crossOrigin'"})," to ",(0,s.jsx)(n.code,{children:"'anonymous'"})," to be able to take a snapshot."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",metastring:"showLineNumbers",children:"<script type=\"text/javascript\">\n    var playerConfig = { // the basic configuration of the player\n        'playback': {\n            'autoplay'    : true,\n            'automute'    : true,\n            'muted'       : false,\n            'crossOrigin' :'anonymous'\n        },\n        'events': {},\n        'source': {\n            'defaults': {\n                'service': 'bintu'\n            },\n            'entries': [\n                {\n                    'index': 0,\n                    'label': 'stream 1',\n                    'h5live': {\n                        'rtmp': {\n                            'streamname': 'xxxx-xxxx' // your streamname\n                        }\n                    }\n                }\n            ]\n        },\n        'style': {\n            'width'                : 'auto',\n            'height'               : 'auto'\n        }\n    };\n    var player, activeVideoElement, canvasElement, canvasContext, imgElement, snapshot; // defining the necessary variables\n<\/script>\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"Add functions that handle drawing the video on a canvas and convert it to an image."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",metastring:"showLineNumbers",children:"<script type=\"text/javascript\">\n    function drawImageOnCanvas () { // paint the current video frame on a canvas\n        if (activeVideoElement) {\n            var w, h;\n            w = activeVideoElement.clientWidth;\n            h = activeVideoElement.clientHeight;\n            canvasElement.width = w;\n            canvasElement.height = h;\n            canvasContext.drawImage(activeVideoElement, 0, 0, w, h);\n        }\n    }\n    function getImageFromCanvas () { // get a jpeg encoded image as dataURL string from the canvas\n        return canvasElement.toDataURL('image/jpeg', 1);\n    }\n    function showSnapshot (dataURL) { // set the dataURL string as image source\n        imgElement.src = dataURL;\n    }\n    function takeSnapshot (){ // take the snapshot by drawing the video on a canvas, getting the image and display it in a img element\n        drawImageOnCanvas();\n        snapshot = getImageFromCanvas();\n        showSnapshot(snapshot);\n    }\n<\/script>\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsx)(n.li,{children:"Create event handlers that connect the player to the snapshot functionality. It is essential to get the active video element reference and invalidate it on destroy. For demonstrative purposes snapshots are taken on play, on pause and when the active video element is changing."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",metastring:"showLineNumbers",children:'<script type="text/javascript">\n    function onActiveVideoElementChange (event) { // fires if a video element for playback will be activated or changed\n        activeVideoElement = event.data.activeVideoElement; // store a reference to the active video element to be able to access it\n        takeSnapshot();\n    }\n    function onPlay (event) { // fires if the playback has been started\n        takeSnapshot();\n    }\n    function onPause (event) { // fires if the playback has been stopped\n        takeSnapshot();\n    }\n    function onDestroy (event) { // fires if the player will be destroyed\n        activeVideoElement = null; // remove the reference to the element, the element should not be accessed after destroy\n    }\n<\/script>\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"5",children:["\n",(0,s.jsx)(n.li,{children:"Prepare DOM elements and setup the player."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",metastring:"showLineNumbers",children:"<script type=\"text/javascript\">\n    function prepareElements () { // load necessary DOM elements into variables\n        canvasElement = document.createElement('canvas');\n        canvasContext = canvasElement.getContext('2d');\n        imgElement = document.querySelector('img');\n    }\n    function preparePlayerConfig () { // add additional needed parameters to the player configuration\n        playerConfig.playback.crossOrigin = 'anonymous';\n        playerConfig.events.onActiveVideoElementChange = onActiveVideoElementChange;\n        playerConfig.events.onPlay = onPlay;\n        playerConfig.events.onPause = onPause;\n        playerConfig.events.onDestroy = onDestroy;\n    }\n    function initPlayer () { // instanciate and setup the player\n        player = new NanoPlayer('playerDiv');\n        player.setup(playerConfig).then(function (_config) {\n            console.log('setup ok with playerConfig: ' + JSON.stringify(_config));\n        }, function (error) {\n            console.log(error);\n        });\n    }\n    document.addEventListener('DOMContentLoaded', function () {\n        prepareElements();\n        preparePlayerConfig();\n        initPlayer();\n    });\n<\/script>\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);